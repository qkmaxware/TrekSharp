@typeparam TItem

<div class="w3-modal no-print @(ShowModalCss)">
    <div class="w3-modal-content">
        <div class="w3-container w3-padding elbow-left elbow-right knee-left knee-right w3-black lcars-border-primary">
            <div class="lcars">
                <div class="secondary elbow-left elbow-right knee-left knee-right">
                    <h3>@Title</h3>
                </div>
                <div class="w3-container">
                    Paste your save file json data into the text area below and press load. 
                </div>
            </div>

            <textarea style="width: 100%; height: 480px; max-height: 80%; resize: vertical;" @bind="jsonData"></textarea>
            @if (loadError != null) {
            <div class="w3-panel w3-red">
                <p>@loadError.Message</p>
            </div> 
            }
            <div class="w3-row">
                <div class="w3-half">
                    <button class="w3-button" @onclick="Close"> Cancel</button>
                </div>
                <div class="w3-half w3-right-align">
                    <button class="w3-button" @onclick="Load"> Load</button>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public string Title {get; set;} = "Import";
    [Parameter]
    public Action<TItem> OnLoad {get; set;} = null;

    private bool ShowModal;
    public string ShowModalCss => ShowModal ? "w3-show" : "w3-hide";

    private string jsonData;
    private Exception loadError = null;

    public void Open() {
        this.ShowModal= true;
        jsonData = string.Empty;
        loadError = null;
    }

    public void Close() {
        this.ShowModal = false;
    }

    public void Load() {
        try {
            var newData = System.Text.Json.JsonSerializer.Deserialize<TItem>(jsonData);
            this.ShowModal = false;
            if (OnLoad != null) {
                OnLoad(newData);
            }
        } catch (Exception e) {
            loadError = e;
        }
    }

}