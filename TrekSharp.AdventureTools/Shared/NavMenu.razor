@inherits AppComponentBase

<div class="w3-sidebar w3-bar-block w3-collapse w3-card w3-animate-left w3-black no-print @NavMenuCssClass" style="width:200px; z-index: 101;" id="mySidebar">
    <button class="w3-bar-item w3-button w3-large w3-hide-large" @onclick="CloseNavMenu">Close &times;</button>
    <NavLink class="w3-button w3-block" href="" Match="NavLinkMatch.All">
        Home
    </NavLink>
    <button class="w3-button w3-block w3-left-align lcars" @onclick="@(() => collapseCreateMenu = !collapseCreateMenu)"  style="padding-bottom: 0px;">
        <div class="row">
            <div class="hbar knee-left" style="margin-right:10px;"></div>
            <div>
                Create <i class="fa fa-caret-down"></i>
            </div>
            <div class="hbar knee-right elbow-right row-fill" style="margin-left:10px;"></div>
        </div>
    </button>
    <div id="CreateAccordion" class="@(CreateMenuCssClass) lcars w3-margin-bottom" style="padding-top: 0px;">
        <div class="lbar">
            <NavLink class="w3-button w3-block" href="new/random/plot" Match="NavLinkMatch.All">
                Plot
            </NavLink>
            <NavLink class="w3-button w3-block" href="new/player" Match="NavLinkMatch.All">
                Player
            </NavLink>
            <NavLink class="w3-button w3-block" href="new/support" Match="NavLinkMatch.All">
                Support Character
            </NavLink>
            <NavLink class="w3-button w3-block" href="new/ship" Match="NavLinkMatch.All">
                Ship
            </NavLink>
            <NavLink class="w3-button w3-block" href="new/grid" Match="NavLinkMatch.All">
                Battle Grid
            </NavLink>
        </div>
    </div>
    <button class="w3-button w3-block w3-left-align lcars" @onclick="@(() => collapsePlayMenu = !collapsePlayMenu)" style="padding-bottom: 0px;">
        <div class="row">
            <div class="hbar knee-left" style="margin-right:10px;"></div>
            <div>
                Manage <i class="fa fa-caret-down"></i>
            </div>
            <div class="hbar knee-right elbow-right row-fill" style="margin-left:10px;"></div>
        </div>
    </button>
    <div id="PlayAccordion" class="@(PlayMenuCssClass) lcars w3-margin-bottom" style="padding-top: 0px;">
        <div class="lbar">
            <NavLink class="w3-button w3-block" href="manage/characters" Match="NavLinkMatch.All">
                Characters
            </NavLink>
            <NavLink class="w3-button w3-block" href="manage/ships" Match="NavLinkMatch.All">
                Ships
            </NavLink>
            <NavLink class="w3-button w3-block" href="manage/task/extended" Match="NavLinkMatch.All">
                Extended Tasks
            </NavLink>
        </div>
    </div>
    <button class="w3-button w3-block w3-left-align lcars" @onclick="@(() => collapseCalcMenu = !collapseCalcMenu)" style="padding-bottom: 0px;">
        <div class="row">
            <div class="hbar knee-left" style="margin-right:10px;"></div>
            <div>
                Calculate <i class="fa fa-caret-down"></i>
            </div>
            <div class="hbar knee-right elbow-right row-fill" style="margin-left:10px;"></div>
        </div>
    </button>
    <div id="CalculatorAccordion" class="@(CalculatorCssClass) lcars w3-margin-bottom" style="padding-top: 0px;">
        <div class="lbar">
            <NavLink class="w3-button w3-block" href="calculate/stardate" Match="NavLinkMatch.All">
                Stardate
            </NavLink>
            <NavLink class="w3-button w3-block" href="calculate/warpspeed" Match="NavLinkMatch.All">
                Warp Speed
            </NavLink>
        </div>
    </div>
    <div class="w3-padding w3-center" style="position: absolute; bottom: 0; width: 100%; overflow: hidden;">
        <button 
            style="border: 0; padding: 0; background-color: inherit;"
            title="Save"
            @onclick="downloadDataJson"
        >
            <img src="assets/save.png" width="32" height="32">
        </button>
        <button 
            style="border: 0; padding: 0; background-color: inherit;"
            title="Load"
            @onclick="@(() => importer?.Open())"
        >
            <img src="assets/load.png" width="32" height="32">
        </button>
        <a 
            href="https://github.com/qkmaxware/TrekSharp"
            target="_blank"
            style="border: 0; padding: 0; background-color: inherit;"
            title="Contribute"
        >
            <img src="assets/github.png" width="32" height="32">
        </a>
    </div>
</div>

<div class="lcars no-print" style="position: absolute;">
<div 
    class="w3-button lcars-primary w3-large w3-hide-large w3-padding elbow-right knee-right" 
    style="position:absolute; left:-1px; top:12px; writing-mode: vertical-rl; text-orientation: mixed; z-index: 100;" 
    @onclick="OpenNavMenu"
> Menu
</div>
</div>

<AssetImporter
    @ref="importer"
    TItem = "AppData"
    Title ="Load"
    OnLoad = "loadAppData"
/>

@code {

    private bool collapseNavMenu = true;
    private string NavMenuCssClass => collapseNavMenu ? "w3-hide" : "w3-show";

    private bool collapseCreateMenu = false;
    private string CreateMenuCssClass => collapseCreateMenu ? "w3-hide" : "w3-show";
    private bool collapsePlayMenu = false;
    private string PlayMenuCssClass => collapsePlayMenu ? "w3-hide" : "w3-show";
    private bool collapseCalcMenu = false;
    private string CalculatorCssClass => collapseCalcMenu ? "w3-hide" : "w3-show";


    private bool showLoadingModal = false;
    private string LoadModalCss => !showLoadingModal ? "w3-hide" : "w3-show";

    public void ToggleNavMenu() {
        collapseNavMenu = !collapseNavMenu;
    }

    public void CloseNavMenu() {
        collapseNavMenu = true;
    }
    public void OpenNavMenu() {
        collapseNavMenu = false;
    }

    private AssetImporter<AppData> importer;

    private void loadAppData(AppData newData) {
        this.Data.Overwrite(newData);
        this.NavigationManager.NavigateTo("");
    }

    private async Task downloadDataJson() {
        // Generate a text file
        await this.DownloadJson("adventure", Data);
    }
}
